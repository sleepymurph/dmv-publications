\chapter{DMV Architecture}

DMV's data set and its history are represented as a DAG, and its architecture
flows from that.

Each DMV node is a \newterm{repository} consisting of a content-addressable
\newterm{object store} for immutable DAG objects and a \newterm{working
directory} for active file editing (\autoref{fig:dia_obj_db_and_wd}).
Repositories that are used only for storage can omit the working directory,
similar to a Git bare repository.

\begin{figure}[h]
  \centering
    \includegraphics[width=0.5\textwidth]{dia_obj_db_and_wd}
  \caption{Repositories, object stores, and working directories}
  \label{fig:dia_obj_db_and_wd}
\end{figure}

Each repository is autonomous, storing a portion of the DAG, and able to add to
it at any time. However, it can transfer DAG objects to and from other
repositories, and it can cache data about what DAG objects are available at a
remote repository. Thus, DMV forms an ad-hoc, unstructured network of
repositories, and each repository can inform the user about what data is
available where. Together, the repositories hold the entire data set
(\autoref{fig:dia_architecture}).

\begin{figure}[h]
  \centering
    \includegraphics[width=0.95\textwidth]{dia_architecture}
  \caption{Repositories in an ad-hoc network}
  \label{fig:dia_architecture}
\end{figure}

DMV assumes that each node will connect to a human-scale number of other nodes,
maybe tens or hundreds. DMV does not dictate network structure. The user or a
higher-level application may determine the network topology and workflow
according to their needs.

Actual network connects need only be made when transferring objects or updating
lists of available nodes. So intermittent or high-latency networks are not a
problem\perotto{already said}.
